const line=()=>{const t=24,e=24,a=24,s=48;let i=0,c=0;const n=d3.select(".line-artist"),o=n.select("svg"),r={};let l;const d=d3.timeParse("%Y-%m-%d"),m=()=>{const t=d3.scaleTime().domain(d3.extent(l,t=>t.dia)),e=d3.scaleLinear().domain([0,d3.max(l,t=>1.25*t.visitas)]);r.count={x:t,y:e}},p=l=>{const d=n.node().offsetWidth;i=d-s-e,c=600-t-a,o.attr("width",d).attr("height",600);const m=`translate(${s},${t})`,p=o.select(".line-artist-container");p.attr("transform",m);const v=d3.line().x(t=>r.count.x(t.dia)).y(t=>r.count.y(t.visitas));((t,e)=>{r.count.x.range([0,t]),r.count.y.range([e,0])})(i,c);const u=n.select(".line-artist-container-dos"),x=u.selectAll(".line").data([l]),f=x.enter().append("path").attr("class","line").attr("stroke-width","1.5"),g=u.selectAll(".circles").data(l),h=g.enter().append("circle").attr("class","circles");x.merge(f).transition().duration(600).ease(d3.easeLinear).attr("d",v),g.merge(h).transition().duration(600).ease(d3.easeLinear).attr("cx",t=>r.count.x(t.dia)).attr("cy",t=>r.count.y(t.visitas)).attr("r",t=>"2019-05-21"===t.fecha?5:0),(t=>{const e=d3.axisBottom(r.count.x).tickFormat(d3.timeFormat("%m-%d")).ticks(13);t.select(".axis-x").attr("transform",`translate(0,${c})`).call(e);const a=d3.axisLeft(r.count.y).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-i);t.select(".axis-y").call(a)})(p)};const v=()=>{d3.csv("csv/episodio-dos.csv",(t,e)=>{if(t)console.log(t);else{const t=Array.from(d3.group(e,t=>t.artista),([t,e])=>({key:t,value:e})),a=d3.select("#select-artist");a.selectAll("option").data(t).enter().append("option").attr("value",t=>t.key).text(t=>t.key),a.on("change",function(){d3.select(this).property("value");console.log("select cambiando"),d3.csv("csv/episodio-dos.csv",(t,e)=>{l=e,console.log("funcion update");let a=d3.select("#select-artist").property("value");(l=l.filter(t=>String(t.artista).match(a))).forEach(t=>{t.nombre=t.artista,t.visitas=+t.visitas,t.dia=d(t.fecha),m()}),p(l)})})}})};window.addEventListener("resize",()=>{p(l)}),d3.csv("csv/episodio-dos.csv",(t,e)=>{if(t)console.log(t);else{const t="Amaral";(l=e.filter(e=>String(e.artista).match(t))).forEach(t=>{t.nombre=t.artista,t.visitas=+t.visitas,t.dia=d(t.fecha)}),v(),(()=>{const t=o.select(".line-artist-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","line-artist-container-dos")})(),m(),p(l)}})};line(),new SlimSelect({select:"#select-artist",searchPlaceholder:"Selecciona una artista..."});