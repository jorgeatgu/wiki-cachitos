const menu=()=>{const e=document.querySelector(".overlay"),t=document.querySelector(".navegacion"),a=document.querySelector("body"),c=document.querySelectorAll(".navegacion-btn"),s=document.querySelector(".burger"),n=()=>{s.classList.toggle("clicked"),e.classList.toggle("show"),t.classList.toggle("show"),a.classList.toggle("overflow")};document.querySelector(".burger").addEventListener("click",n),document.querySelector(".overlay").addEventListener("click",n);let i=0;for(;i<c.length;i++)c[i].addEventListener("click",function(){r()});const r=()=>{e.classList.remove("show"),t.classList.remove("show"),s.classList.remove("clicked")}};menu();const line=(e,t,a)=>{const c=24,s=24,n=24,i=48;let r=0,o=0;const l=d3.select(`.line-${t}`),d=l.select("svg"),h={};let p;const u=d3.timeParse("%Y-%m-%d");let m;const v=()=>{const e=d3.scaleTime().domain(d3.extent(p,e=>e.dia)),t=d3.scaleLinear().domain([0,d3.max(p,e=>1.25*e.visitas)]);h.count={x:e,y:t}},g=e=>{l.select(".tooltip").remove(),m=l.append("div").attr("class","tooltip tooltip-cachitos");(e=>{p[0].diferencia>0?m.data(p).html(e=>`\n                        <p class="tooltip-text">El día de la emisión las visitas aumentaron en un: <span class="tooltip-number">${e.diferencia}%</span></p>\n\n                        `).transition().duration(300):m.attr("class","tooltip tooltip-negative").data(p).html(e=>`\n                        <p class="tooltip-text">El día de la emisión las visitas descendieron en un: <span class="tooltip-number">${e.diferencia}%</span></p>\n\n                        `).transition().duration(300)})()},x=e=>{const p=l.node().offsetWidth;r=p-i-s,o=600-c-n,d.attr("width",p).attr("height",600);const u=`translate(${i},${c})`,m=d.select(`.line-${t}-container`);m.attr("transform",u);const v=d3.line().x(e=>h.count.x(e.dia)).y(e=>h.count.y(e.visitas));((e,t)=>{h.count.x.range([0,e]),h.count.y.range([t,0])})(r,o);const g=l.select(`.line-${t}-container-dos`),x=g.selectAll(".line").data([e]),f=x.enter().append("path").attr("class","line").attr("stroke-width","1.5"),y=g.selectAll(".circles").data(e),S=y.enter().append("circle").attr("class","circles");x.merge(f).transition().duration(600).ease(d3.easeLinear).attr("d",v),y.merge(S).transition().duration(600).ease(d3.easeLinear).attr("cx",e=>h.count.x(e.dia)).attr("cy",e=>h.count.y(e.visitas)).attr("r",e=>e.fecha===a?5:0),(e=>{const t=d3.axisBottom(h.count.x).tickFormat(d3.timeFormat("%m-%d")).ticks(8);e.select(".axis-x").attr("transform",`translate(0,${o})`).call(t);const a=d3.axisLeft(h.count.y).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-r);e.select(".axis-y").call(a)})(m)};const f=()=>{d3.csv(e,a=>{const c=Array.from(d3.group(a,e=>e.artista),([e,t])=>({key:e,value:t})),s=d3.select(`#select-${t}`);s.selectAll("option").data(c).enter().append("option").attr("value",e=>e.key).text(e=>e.key),s.on("change",function(){d3.select(this).property("value");d3.csv(e,e=>{p=e;let a=d3.select(`#select-${t}`).property("value");(p=p.filter(e=>String(e.artista).match(a))).forEach(e=>{e.nombre=e.artista,e.visitas=+e.visitas,e.dia=u(e.fecha),v()}),g(p),x(p)})})})};window.addEventListener("resize",()=>{x(p)}),d3.csv(e,e=>{const a=e[0].artista;(p=e.filter(e=>String(e.artista).match(a))).forEach(e=>{e.nombre=e.artista,e.visitas=+e.visitas,e.dia=u(e.fecha)}),f(),(()=>{const e=d.select(`.line-${t}-container`);e.append("g").attr("class","axis axis-x"),e.append("g").attr("class","axis axis-y"),e.append("g").attr("class",`line-${t}-container-dos`)})(),v(),g(p),x(p)})},cachitos=[["csv/episodio-uno.csv","chapter-one","2019-04-23"],["csv/episodio-dos.csv","chapter-two","2019-05-21"],["csv/episodio-tres.csv","chapter-three","2019-05-28"],["csv/episodio-cuatro.csv","chapter-four","2019-06-04"],["csv/episodio-cinco.csv","chapter-five","2019-06-11"],["csv/episodio-seis.csv","chapter-six","2019-06-18"],["csv/episodio-siete.csv","chapter-seven","2019-06-25"]];for(const e of cachitos)line(...e);new SlimSelect({select:"#select-chapter-one",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-two",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-three",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-four",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-five",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-six",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-seven",searchPlaceholder:"Selecciona una artista..."});const barHorizontal=()=>{const e=24,t=24,a=24,c=96;let s=0,n=0;const i=d3.select(".chart-torp-bar-horizontal"),r=i.select("svg"),o={};let l;const d=l=>{const d=i.node().offsetWidth,h=20*l.length;s=d-c-t,n=h-e-a,r.attr("width",d).attr("height",h);const p=`translate(${c},${e})`,u=r.select(".chart-torp-bar-horizontal-container");u.attr("transform",p),((e,t)=>{o.count.x.range([0,e]),o.count.y.range([t,0])})(s,n);const m=i.select(".area-container-chart-horizontal").selectAll(".bar-horizontal").data(l),v=m.enter().append("rect").attr("class","bar-horizontal");m.merge(v).attr("x",0).attr("y",e=>o.count.y(e.artista)).attr("height",n/l.length-2).attr("width",e=>o.count.x(e.diferencia)),(e=>{const t=d3.axisTop(o.count.x).tickFormat(e=>e+"%").tickSize(n);e.select(".axis-x").attr("transform",`translate(0,${n})`).call(t);const a=d3.axisLeft(o.count.y);e.select(".axis-y").call(a)})(u)};window.addEventListener("resize",()=>{d(l)}),d3.csv("csv/torp.csv",(e,t)=>{e?console.log(e):((l=t).forEach(e=>{e.diferencia=+e.diferencia}),l.sort((e,t)=>e.diferencia-t.diferencia),(()=>{const e=r.select(".chart-torp-bar-horizontal-container");e.append("g").attr("class","axis axis-x"),e.append("g").attr("class","axis axis-y"),e.append("g").attr("class","area-container-chart-horizontal")})(),(()=>{const e=d3.scaleLinear().domain([0,d3.max(l,e=>1.25*e.diferencia)]),t=d3.scaleBand().domain(l.map(e=>e.artista)).paddingInner(.1).paddingOuter(.5);o.count={x:e,y:t}})(),d(l))})};barHorizontal();