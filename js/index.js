const menu=()=>{const t=document.querySelector(".overlay"),e=document.querySelector(".navegacion"),a=document.querySelector("body"),s=document.querySelectorAll(".navegacion-btn"),c=document.querySelector(".burger"),n=()=>{c.classList.toggle("clicked"),t.classList.toggle("show"),e.classList.toggle("show"),a.classList.toggle("overflow")};document.querySelector(".burger").addEventListener("click",n),document.querySelector(".overlay").addEventListener("click",n);let i=0;for(;i<s.length;i++)s[i].addEventListener("click",function(){o()});const o=()=>{t.classList.remove("show"),e.classList.remove("show"),c.classList.remove("clicked")}};menu();const line=(t,e,a)=>{const s=24,c=24,n=24,i=48;let o=0,r=0;const l=d3.select(`.line-${e}`),d=l.select("svg"),p={};let h;const u=d3.timeParse("%Y-%m-%d");let m;const v=()=>{const t=d3.scaleTime().domain(d3.extent(h,t=>t.dia)),e=d3.scaleLinear().domain([0,d3.max(h,t=>1.25*t.visitas)]);p.count={x:t,y:e}},g=t=>{l.select(".tooltip").remove(),m=l.append("div").attr("class","tooltip tooltip-cachitos");(t=>{h[0].diferencia>0?m.data(h).html(t=>`\n                        <p class="tooltip-text">El día de la emisión las visitas aumentaron en un: <span class="tooltip-number">${t.diferencia}%</span></p>\n\n                        `).transition().duration(300):h[0].diferencia<0?m.attr("class","tooltip tooltip-negative").data(h).html(t=>`\n                        <p class="tooltip-text">El día de la emisión las visitas descendieron en un: <span class="tooltip-number">${t.diferencia}%</span></p>\n\n                        `).transition().duration(300):m.data(h).html(t=>'\n                        <p class="tooltip-text">Las visitas ni aumentaron ni descendieron.</p>\n\n                        ').transition().duration(300)})()},x=t=>{const h=l.node().offsetWidth;o=h-i-c,r=600-s-n,d.attr("width",h).attr("height",600);const u=`translate(${i},${s})`,m=d.select(`.line-${e}-container`);m.attr("transform",u);const v=d3.line().x(t=>p.count.x(t.dia)).y(t=>p.count.y(t.visitas));((t,e)=>{p.count.x.range([0,t]),p.count.y.range([e,0])})(o,r);const g=l.select(`.line-${e}-container-dos`),x=g.selectAll(".line").data([t]),f=x.enter().append("path").attr("class","line").attr("stroke-width","1.5"),y=g.selectAll(".circles").data(t),S=y.enter().append("circle").attr("class","circles");x.merge(f).transition().duration(600).ease(d3.easeLinear).attr("d",v),y.merge(S).transition().duration(600).ease(d3.easeLinear).attr("cx",t=>p.count.x(t.dia)).attr("cy",t=>p.count.y(t.visitas)).attr("r",t=>t.fecha===a?5:0),(t=>{const e=d3.axisBottom(p.count.x).tickFormat(d3.timeFormat("%m-%d")).ticks(8);t.select(".axis-x").attr("transform",`translate(0,${r})`).call(e);const a=d3.axisLeft(p.count.y).tickFormat(d3.format("d")).ticks(5).tickSizeInner(-o);t.select(".axis-y").call(a)})(m)};const f=()=>{d3.csv(t,a=>{const s=Array.from(d3.group(a,t=>t.artista),([t,e])=>({key:t,value:e})),c=d3.select(`#select-${e}`);c.selectAll("option").data(s).enter().append("option").attr("value",t=>t.key).text(t=>t.key),c.on("change",function(){d3.select(this).property("value");d3.csv(t,t=>{h=t;let a=d3.select(`#select-${e}`).property("value");(h=h.filter(t=>String(t.artista).match(a))).forEach(t=>{t.nombre=t.artista,t.visitas=+t.visitas,t.dia=u(t.fecha),v()}),g(h),x(h)})})})};window.addEventListener("resize",()=>{x(h)}),d3.csv(t,t=>{const a=t[0].artista;(h=t.filter(t=>String(t.artista).match(a))).forEach(t=>{t.nombre=t.artista,t.visitas=+t.visitas,t.dia=u(t.fecha)}),f(),(()=>{const t=d.select(`.line-${e}-container`);t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class",`line-${e}-container-dos`)})(),v(),g(h),x(h)})},cachitos=[["csv/episodio-uno.csv","chapter-one","2019-04-23"],["csv/episodio-dos.csv","chapter-two","2019-05-21"],["csv/episodio-tres.csv","chapter-three","2019-05-28"],["csv/episodio-cuatro.csv","chapter-four","2019-06-04"],["csv/episodio-cinco.csv","chapter-five","2019-06-11"],["csv/episodio-seis.csv","chapter-six","2019-06-18"],["csv/episodio-siete.csv","chapter-seven","2019-06-25"]];for(const t of cachitos)line(...t);new SlimSelect({select:"#select-chapter-one",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-two",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-three",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-four",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-five",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-six",searchPlaceholder:"Selecciona una artista..."}),new SlimSelect({select:"#select-chapter-seven",searchPlaceholder:"Selecciona una artista..."});const barHorizontal=()=>{const t=24,e=24,a=24,s=96;let c=0,n=0;const i=d3.select(".chart-torp-bar-horizontal"),o=i.select("svg"),r={};let l;const d=l=>{const d=i.node().offsetWidth,p=20*l.length;c=d-s-e,n=p-t-a,o.attr("width",d).attr("height",p);const h=`translate(${s},${t})`,u=o.select(".chart-torp-bar-horizontal-container");u.attr("transform",h),((t,e)=>{r.count.x.range([0,t]),r.count.y.range([e,0])})(c,n);const m=i.select(".area-container-chart-horizontal").selectAll(".bar-horizontal").data(l),v=m.enter().append("rect").attr("class","bar-horizontal");m.merge(v).attr("x",0).attr("y",t=>r.count.y(t.artista)).attr("height",n/l.length-2).attr("width",t=>r.count.x(t.diferencia)),(t=>{const e=d3.axisTop(r.count.x).tickFormat(t=>t+"%").tickSize(n);t.select(".axis-x").attr("transform",`translate(0,${n})`).call(e);const a=d3.axisLeft(r.count.y);t.select(".axis-y").call(a)})(u)};window.addEventListener("resize",()=>{d(l)}),d3.csv("csv/torp.csv",(t,e)=>{t?console.log(t):((l=e).forEach(t=>{t.diferencia=+t.diferencia}),l.sort((t,e)=>t.diferencia-e.diferencia),(()=>{const t=o.select(".chart-torp-bar-horizontal-container");t.append("g").attr("class","axis axis-x"),t.append("g").attr("class","axis axis-y"),t.append("g").attr("class","area-container-chart-horizontal")})(),(()=>{const t=d3.scaleLinear().domain([0,d3.max(l,t=>1.25*t.diferencia)]),e=d3.scaleBand().domain(l.map(t=>t.artista)).paddingInner(.1).paddingOuter(.5);r.count={x:t,y:e}})(),d(l))})};barHorizontal();